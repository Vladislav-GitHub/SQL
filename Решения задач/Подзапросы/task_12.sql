with cancelled_orders as (
    SELECT order_id
    FROM   user_actions
    WHERE  action = 'cancel_order'
)

SELECT count(distinct order_id) as orders_canceled,
       count(order_id) filter (WHERE action = 'deliver_order') as orders_canceled_and_delivered
FROM   courier_actions
WHERE  order_id in (SELECT * FROM   cancelled_orders)